title User initiated DA creation with DAA

Participant User  
Participant DAA
Participant Issuer
Participant Cloud Agent
Participant DAS
Participant ARD


User -> DAA: I want a Digital Address\n(accept T&C)
DAA -> DAA: ID proofing starts on the device and extracts the user info
DAA->User: Provide additional attributes to generate HIDA
DAA -> DAA: compute HIDA = hash (ID-Attribs)
DAA -> DAS: securely send HIDA,and request Digital Address
DAS -> ARD: lookup TA_USER_ISSUER for HIDA
ARD -> ARD: lookup TA for HIDA
alt TA not found
ARD -> ARD: Generate TA = random
end
ARD --> DAS: No conflict with TA.\n Return TA_USER_ISSUER
DAS->DAS: Provision a Cloud Agent for User with HIDA
DAS->Cloud Agent: Request to Create DAS_USER_ID for HIDA
Cloud Agent ->Cloud Agent: Create DAS_USER_ID & DAS_USER_ID_PK/SK
Cloud Agent->DAS: Send [DAS_USER_ID, DAS_USER_ID_PK] to DAS
DAS -> DAS: Create DA. Store [DA, TA_USER_ISSUER, DAS_USER_ID]
DAS -> ARD: Send [DAS_USER_ID, HIDA, HomeDAS_ID] to notify about DA
ARD -> ARD: store [HIDA, TA]\n [TA, DAS_USER_ID, HomeDAS_ID=DAS_ID]
ARD --> DAS: Success
DAS->DAA: Send DAS_USER_ID, DA
DAA -> DAA: If successful: Remember DAS_USER_ID, DA
DAA -> DAS: Register FIDO Authenticator for new device\n [DAS_USER_ID, USER_FIDO_PK]
DAS-> DAS: Remember (USER_FIDO_PK, DAS_USER_ID)
DAS --> DAA: acknowledge successful FIDO registration
DAA->User: Digital Address enrolled and ready for use
