title Delegated Recovery-Multiple Delegatees
actor User
participant User DAA
participant User HomeDAS
Participant ARD
participant Delegatee HomeDAS
participant Delegatee DAA
actor Delegated User


opt Delegatee Setup
User->User DAA: Set up Delegatees List [Delegatee DA]
User DAA->>User HomeDAS: Notify the Delegatees of nomination
User HomeDAS->>User HomeDAS: Resolve HomeDAS from DA

loop For each Delegatee
alt Delegatee in same HomeDAS
User HomeDAS->>Delegatee DAA: Notify Delegatee
else Delegatee in Different DAS
User HomeDAS->>ARD: ADIA-DR-004: Lookup HomeDAS Delegatee.
ARD-->>User HomeDAS: ADIA-DR-004: DAS_ID for Delegatee HomeDAS
User HomeDAS->>Delegatee HomeDAS: Route to Delegatee HomeDAS [DAS_ID]
Delegatee HomeDAS->Delegatee HomeDAS: Lookup DAS_USER_ID and Device Information
Delegatee HomeDAS->>Delegatee DAA: Notify Delegatee
end

Delegated User-->>Delegatee DAA: View and Accept/Reject
Delegatee DAA-->>Delegatee HomeDAS: Accept/Reject status
Delegatee HomeDAS-->>User HomeDAS: Delegatee Accept/Reject Status
User HomeDAS-->>User DAA: Delegatee Accept/Reject Status [Delegatee DAS_USER_ID]
end
end


opt DA Recovery (Multiple Users)
User->User DAA: I need to recover my access (New Device)
User DAA->User HomeDAS: Provide DA and Select Delegatees
User HomeDAS->User HomeDAS: Generate a recovery code, TRANSACTION_ID
User HomeDAS-->User DAA: Send Recovery Code
User->>Delegated User: Provide Recovery Code (Manual)
Delegated User->>Delegatee DAA: Select User DA + Enter Recovery Code
Delegatee DAA->Delegatee HomeDAS: Send User DA + Recovery Code


alt Recovery Request - Delegatee in same HomeDAS
Delegatee HomeDAS->>Delegatee HomeDAS: ADIA-DR-004: Resolve User DA
Delegatee HomeDAS-->>User HomeDAS: Accept/Reject Status [TRANSACTION_ID, Recovery Code,DAS_USER_ID, Status]
else Recovery Request - Delegatee in Different DAS
Delegatee HomeDAS->>ARD: ADIA-DR-004:Lookup User HomeDAS
ARD-->>Delegatee HomeDAS: ADIA-DR-004:: DAS_ID for User HomeDAS
Delegatee HomeDAS-->>User HomeDAS: Accept/Reject Status [TRANSACTION_ID, Recovery Code,DAS_USER_ID, Status]
end


User HomeDAS->User HomeDAS: Lookup Recovery Code, TRANSACTION_ID
User HomeDAS->User HomeDAS: Minimum criteria met (Delegatee Count>3)
User HomeDAS->User HomeDAS: Delegatee Accept/Reject Status
User HomeDAS-->>User DAA: Notify with Success/Failure
User HomeDAS->User DAA: Recover DA and Sync Credential Metadata
User DAA->User: Recovery Complete
end
