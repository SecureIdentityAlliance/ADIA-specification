Title: User Bootstraps New DAA Instance
Participant User
Participant DAA
Participant Issuer
<<<<<<< HEAD
Participant Cloud Agent
Participant DAP
Participant GADI
=======
Participant DAP Agency
Participant Regional GADI Directory
>>>>>>> master
User -> Issuer: I want to recover my Digital Address because lost device
Issuer -> Issuer: lookup ID-Attribs for that user
Issuer -> Issuer: compute HIDA = hash(ID-Attribs)
Issuer -> DAP Agency: securely send HIDA
DAP Agency -> DAP Agency: lookup TA_USER_ISSUER for HIDA
DAP Agency -> Regional GADI Directory: if TA_USER_ISSUER not found: lookup TA_USER_ISSUER for HIDA
Regional GADI Directory -> Regional GADI Directory: lookup TA for HIDA (not found)
Global GADI Directory -> Global GADI Directory: lookup TA for HIDA (found)
Global GADI Directory -> Regional GADI Directory: Return found on Home_DAP_ID
Regional GADI Directory --> DAP Agency: Return found on Home_DAP_ID
DAP Agency --> Issuer: User exists in other DAP Agency (Home_DAP_ID,Home DAP Name)
Issuer --> User: Your DA exists in Home DAP Name.  Use your existing DAA.
User -> Issuer: Want to to bootstrap new phone
Issuer -> Issuer: Lookup DA for HIDA
Issuer -> Issuer: Create QR code (DA, Issuer-URL?)
Issuer -> User: presents or sends the QR code in Web interface/Issuer PC
User -> DAA: Scans the QR code and extracts DA+IssuerURL
DAA -> DAP Agency: ID proofing starts on the device and extracts the user info 
DAP Agency --> DAA: Success
DAA -> Issuer: Send Verified User Attributes + DA to IssuerURL
Issuer -> Issuer: Verifies User Attributes against userDB identified by DA
Issuer -> Issuer: check whether VC(TA_USER_ISSUER, Validation Succeeded) exists (it should)
Issuer -> DAA: validation succeeded for DA+VC(TA_USER_ISSUER, Validation Succeeded)
DAA -> Issuer: Accept DA
Issuer --> DAA: OK
<<<<<<< HEAD
DAA -> DAP: Register FIDO Authenticator for this DA to the DAP (USER_FIDO_PK)
DAP -> DAP: Remember create and store VC(USER_FIDO_PK, DAP_USER_ID)\n replacing old USER_FIDO_PK (from lost device)
DAP --> DAA: acknowledge successful FIDO registration
=======
DAA -> DAP Agency: Register FIDO Authenticator for this DA to the DAP+send VC (implicitly: User accepted DA)
DAP Agency -> DAP Agency: Saves the FIDO public key against TA_USER_ISSUER - replacing old FIDO public key (for lost device)
>>>>>>> master
